<app-subpage-header title="Configuraci√≥n de Marca" subtitle="Personaliza el logo y colores de tu empresa">
</app-subpage-header>

<div class="branding-container" *ngIf="!isLoading; else loadingTemplate">

    <!-- ============================================ -->
    <!-- SECCI√ìN: LOGO -->
    <!-- ============================================ -->
    <div class="branding-section card">
        <div class="section-header">
            <h3>Logo de la Empresa</h3>
            <p class="section-description">
                Sube el logo de tu empresa (JPG, PNG, WebP o SVG). M√°ximo 2MB.
            </p>
        </div>

        <div class="logo-preview-container">
            <!-- Preview del Logo -->
            <div class="logo-preview" [class.has-logo]="companyLogo">
                <img *ngIf="companyLogo" [src]="companyLogo" alt="Logo de la empresa" class="logo-image">
                <div *ngIf="!companyLogo" class="logo-placeholder">
                    <span class="placeholder-icon">üè¢</span>
                    <span class="placeholder-text">Sin logo</span>
                </div>
            </div>

            <!-- Acciones del Logo -->
            <div class="logo-actions">
                <label class="upload-btn" [class.disabled]="isSaving">
                    <input type="file" accept="image/jpeg,image/png,image/webp,image/svg+xml"
                        (change)="onLogoSelected($event)" [disabled]="isSaving" style="display: none;">
                    <span>
                        {{ companyLogo ? 'Cambiar Logo' : 'Subir Logo' }}
                    </span>
                </label>

                <button *ngIf="companyLogo" type="button" class="remove-logo-btn" (click)="removeLogo()"
                    [disabled]="isSaving">
                    Eliminar
                </button>
            </div>

            <p class="logo-hint">
                Recomendamos un logo cuadrado o horizontal con fondo transparente
            </p>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- SECCI√ìN: COLOR CORPORATIVO -->
    <!-- ============================================ -->
    <div class="branding-section card">
        <div class="section-header">
            <h3>Color Corporativo</h3>
            <p class="section-description">
                Selecciona el color principal que represente tu marca.
                Se aplicar√° en toda la plataforma.
            </p>
        </div>

        <!-- Color Picker Principal -->
        <div class="color-picker-group">
            <label class="color-picker-label">
                Color Principal
            </label>

            <div class="color-picker-wrapper">
                <input type="color" [(ngModel)]="primaryColor" (input)="onColorChange(primaryColor)"
                    [disabled]="isSaving" class="color-input">

                <input type="text" [(ngModel)]="primaryColor" (input)="onColorChange(primaryColor)"
                    [disabled]="isSaving" placeholder="#E74C3C" maxlength="7" class="color-text-input">

                <div class="color-preview-box" [style.background-color]="primaryColor"
                    [class.light-color]="isColorLight()">
                    <span class="preview-check">‚úì</span>
                </div>
            </div>
        </div>

        <!-- Colores Predefinidos -->
        <div class="preset-colors-section">
            <label class="preset-label">Colores Predefinidos</label>
            <div class="preset-colors-grid">
                <button *ngFor="let preset of presetColors" type="button" class="color-preset-btn"
                    [class.active]="primaryColor === preset.value" [style.background-color]="preset.value"
                    [title]="preset.name" (click)="selectPresetColor(preset.value)" [disabled]="isSaving">
                    <span class="preset-check" *ngIf="primaryColor === preset.value">‚úì</span>
                </button>
            </div>
        </div>

        <!-- Preview Visual -->
        <div class="color-preview-section">
            <label class="preview-label">Vista Previa</label>
            <div class="preview-components">

                <!-- Bot√≥n Preview -->
                <button class="preview-button" [style.background-color]="primaryColor"
                    [style.color]="isColorLight() ? '#2C3E50' : 'white'">
                    Bot√≥n de Ejemplo
                </button>

                <!-- Badge Preview -->
                <span class="preview-badge" [style.background-color]="primaryColor + '15'" [style.color]="primaryColor">
                    Estado Activo
                </span>

                <!-- Link Preview -->
                <a class="preview-link" [style.color]="primaryColor">
                    Enlace de Ejemplo
                </a>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- ACCIONES PRINCIPALES -->
    <!-- ============================================ -->
    <div class="branding-actions">
        <div class="actions-left">
            <button mat-button type="button" (click)="resetToDefault()"
                [disabled]="isSaving || primaryColor === '#E74C3C'">
                Restaurar por Defecto
            </button>

            <button mat-button type="button" (click)="cancelChanges()" [disabled]="isSaving || !hasUnsavedChanges()">
                Cancelar Cambios
            </button>
        </div>

        <button mat-flat-button color="primary" type="button" (click)="saveBranding()"
            [disabled]="isSaving || !hasUnsavedChanges()">

            <mat-spinner *ngIf="isSaving" diameter="20" style="display: inline-block; margin-right: 8px;">
            </mat-spinner>

            <span>{{ isSaving ? 'Guardando...' : 'Guardar Cambios' }}</span>
        </button>
    </div>

    <!-- Mensaje de Cambios sin Guardar -->
    <div class="unsaved-warning" *ngIf="hasUnsavedChanges() && !isSaving">
        ‚ö†Ô∏è Tienes cambios sin guardar
    </div>

</div>

<!-- ============================================ -->
<!-- LOADING STATE -->
<!-- ============================================ -->
<ng-template #loadingTemplate>
    <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p class="loading-text">Cargando configuraci√≥n...</p>
    </div>
</ng-template>