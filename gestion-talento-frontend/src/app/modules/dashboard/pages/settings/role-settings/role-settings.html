<div class="settings-subpage-container">

  <app-subpage-header title="Configurar Roles y Permisos" backRoute="/dashboard/settings">
    <button *ngIf="can(P.ROLES_MANAGE)" mat-flat-button color="primary" (click)="createNewRole()">
      <mat-icon>add_circle_outline</mat-icon>
      Nuevo Rol
    </button>
  </app-subpage-header>

  <p class="description">
    Define los perfiles de seguridad. El <strong>Rol Autom치tico</strong> se asignar치 por defecto a los nuevos empleados.
  </p>

  <div class="roles-list">

    <div class="role-item header">
      <span style="flex: 2;">Nombre del Rol</span>
      <span style="flex: 1;">Tipo</span>
      <span style="flex: 2;">Permisos</span>
      <span style="flex: 1; text-align: right;">Acciones</span>
    </div>

    <div *ngIf="isLoading" class="loading-state">
      Cargando roles...
    </div>

    <div *ngFor="let role of roles" class="role-item">

      <span class="role-name" style="flex: 2;">
        <strong>{{ role.nombre }}</strong>
        <mat-icon *ngIf="role.esDefecto" class="default-badge-icon" matTooltip="Rol Autom치tico para nuevos empleados">
          verified
        </mat-icon>
      </span>

      <span class="role-type" style="flex: 1;">
        <span [class.badge-auto]="role.esDefecto" [class.badge-manual]="!role.esDefecto">
          {{ role.esDefecto ? 'Autom치tico' : 'Manual' }}
        </span>
      </span>

      <span class="permissions-summary" style="flex: 2;">
        {{ countActivePermissions(role.permisos) }} accesos activos
      </span>

      <div class="actions" style="flex: 1; text-align: right;">

        <button *ngIf="can(P.ROLES_MANAGE)" mat-icon-button color="primary" matTooltip="Editar Permisos"
          (click)="editRole(role)">
          <mat-icon>edit</mat-icon>
        </button>

        <button *ngIf="!can(P.ROLES_MANAGE)" mat-icon-button matTooltip="Ver Detalles (Solo Lectura)"
          (click)="editRole(role)">
          <mat-icon>visibility</mat-icon>
        </button>

        <button *ngIf="can(P.ROLES_MANAGE)" mat-icon-button color="warn" matTooltip="Eliminar Rol"
          (click)="deleteRole(role)" [disabled]="role.esDefecto">
          <mat-icon>delete_outline</mat-icon>
        </button>
      </div>

    </div>

    <div *ngIf="!isLoading && roles.length === 0" class="empty-list-placeholder">
      <mat-icon>security</mat-icon>
      <p>No hay roles definidos. Crea el primero arriba.</p>
    </div>

  </div>
</div>