<div class="settings-subpage-container">
  
  <app-subpage-header title="Configuración de Asistencia y Tiempo" backRoute="/dashboard/settings"></app-subpage-header>

  <p class="description">
    Define las reglas y parámetros para el registro de asistencia de los empleados a través de la aplicación móvil.
  </p>

  <div class="settings-card">
    <div class="card-header">
      <mat-icon class="card-icon">schedule</mat-icon>
      <h4>Horario Laboral Estándar</h4>
    </div>
    
    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Hora de Entrada</mat-label>
        <input matInput type="time" [(ngModel)]="settings.standardStartTime">
      </mat-form-field>
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Hora de Salida</mat-label>
        <input matInput type="time" [(ngModel)]="settings.standardEndTime">
      </mat-form-field>
    </div>
  </div>

  <div class="settings-card">
    <div class="card-header">
      <mat-icon class="card-icon">timer</mat-icon>
      <h4>Reglas de Puntualidad</h4>
    </div>

    <mat-form-field appearance="outline" class="tolerance-field full-width-mobile">
      <mat-label>Tolerancia de Retraso (minutos)</mat-label>
      <input matInput type="number" [(ngModel)]="settings.latenessToleranceMinutes" min="0">
      <mat-hint>Minutos permitidos después de la hora de entrada.</mat-hint>
    </mat-form-field>
  </div>

  <div class="settings-card">
    <div class="card-header">
      <mat-icon class="card-icon">phonelink_lock</mat-icon>
      <h4>Restricciones de Registro Móvil</h4>
    </div>

    <div class="restriction-options">
      <div class="checkbox-row">
        <mat-checkbox [(ngModel)]="settings.requireGeofence" color="primary">
          Requerir estar dentro de la Geocerca de la oficina
        </mat-checkbox>
        <a mat-button [href]="settings.geofenceLink" target="_blank" *ngIf="settings.requireGeofence" class="link-btn">
            <mat-icon>map</mat-icon> Ver Mapa
        </a>
      </div>

      <div class="checkbox-row">
        <mat-checkbox [(ngModel)]="settings.requireWifi" color="primary">
          Requerir conexión a una Red Wi-Fi autorizada
        </mat-checkbox>
      </div>
    </div>

    <div *ngIf="settings.requireWifi" class="wifi-nested-section">
      <h5>Redes Wi-Fi Autorizadas (SSID)</h5>
      
      <div class="wifi-list-box">
        <mat-list role="list">
          <mat-list-item *ngFor="let network of settings.allowedWifiNetworks" role="listitem">
            <span matListItemTitle>{{ network }}</span>
            <button mat-icon-button color="warn" (click)="removeWifiNetwork(network)" matListItemMeta matTooltip="Eliminar Red">
              <mat-icon>delete_outline</mat-icon>
            </button>
          </mat-list-item>
          <mat-list-item *ngIf="settings.allowedWifiNetworks.length === 0">
             <span matListItemTitle class="empty-list">No hay redes configuradas.</span>
          </mat-list-item>
        </mat-list>
      </div>

      <div class="add-wifi-form">
        <mat-form-field appearance="outline" class="condensed-field">
          <mat-label>Añadir SSID de Red Wi-Fi</mat-label>
          <input matInput [(ngModel)]="newWifiNetwork" placeholder="Ej: Oficina-Principal-5G">
        </mat-form-field>
        <button mat-stroked-button color="primary" (click)="addWifiNetwork()" [disabled]="!newWifiNetwork">
          <mat-icon>add</mat-icon> Añadir
        </button>
      </div>
    </div>
  </div>

  <div class="actions-footer">
    <button mat-flat-button color="primary" (click)="saveAttendanceSettings()">
      <mat-icon>save</mat-icon> Guardar Cambios
    </button>
  </div>
</div>