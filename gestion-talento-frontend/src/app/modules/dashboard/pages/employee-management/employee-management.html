<div class="page-container">
  <header class="page-header">
    <h2>Gestión de Personal</h2>

    <div class="view-controls">
      <input type="text" placeholder="Buscar por nombre o cargo..." class="search-input" [(ngModel)]="searchTerm"
        (ngModelChange)="applyFiltersAndSort()">

      <select class="filter-select" [(ngModel)]="selectedDepartment" (ngModelChange)="applyFiltersAndSort()">
        <option value="">Todos los Departamentos</option>
        <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
      </select>

      <button class="btn btn-secondary" (click)="toggleSort()">
        Ordenar Por: {{ sortBy.startsWith('name') ? 'Nombre' : 'Defecto' }}
        {{ sortBy.endsWith('-asc') ? '▲' : '▼' }}
      </button>
    </div>

    <button *ngIf="can(P.EMPLOYEES_CREATE)" mat-flat-button color="primary" (click)="openAddEmployeeDialog()">
      <mat-icon>add</mat-icon>
      Añadir Empleado
    </button>
  </header>

  <div class="employee-grid" @cardAnimation>
    <div *ngFor="let employee of filteredEmployees" class="employee-card">

      <div class="card-header">

        <div class="avatar-wrapper">
          <img *ngIf="employee.fotoUrl" [src]="employee.fotoUrl" alt="Foto de {{employee.nombre}}" class="avatar-img">

          <div *ngIf="!employee.fotoUrl" class="avatar-placeholder">
            {{ getInitials(employee.nombre, employee.apellido) }}
          </div>
        </div>

        <div class="name-role">
          <span class="employee-name">{{ employee.nombre }} {{ employee.apellido }}</span>
          <span class="employee-role">{{ employee.cargo?.nombre || 'Sin Cargo Asignado' }}</span>
        </div>

        <span class="status-badge"
          [ngClass]="{'status-active': employee.estado === 'Activo', 'status-inactive': employee.estado !== 'Activo'}">
          {{ employee.estado }}
        </span>
      </div>

      <div class="card-body">
        <div class="info-row">
          <mat-icon class="info-icon">email</mat-icon>
          <span class="value" [title]="employee.emailPersonal">{{ employee.emailPersonal }}</span>
        </div>

        <div class="info-row">
          <mat-icon class="info-icon">phone</mat-icon>
          <span class="value">{{ employee.telefono || 'Sin teléfono' }}</span>
        </div>

        <div class="info-row">
          <mat-icon class="info-icon">security</mat-icon>
          <span class="value">Rol: {{ employee.rol?.nombre || 'N/A' }}</span>
        </div>
      </div>

      <div class="card-footer">
        <button class="btn-icon btn-primary" [routerLink]="['/dashboard/employee', employee.id]" title="Ver Perfil">
          <mat-icon>visibility</mat-icon>
        </button>

        <button *ngIf="can(P.EMPLOYEES_EDIT)" mat-icon-button (click)="openEditDialog(employee)"
          matTooltip="Editar Datos Personales">
          <mat-icon>edit</mat-icon>
        </button>

        <button *ngIf="can(P.EMPLOYEES_DELETE)" class="btn-icon btn-danger" title="Desactivar"
          (click)="deleteEmployee(employee)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>

    <div *ngIf="filteredEmployees.length === 0 && !isLoading" class="empty-list-placeholder">
      No se encontraron empleados con los filtros aplicados.
    </div>

    <div *ngIf="isLoading" class="empty-list-placeholder">
      Cargando empleados...
    </div>
  </div>
</div>