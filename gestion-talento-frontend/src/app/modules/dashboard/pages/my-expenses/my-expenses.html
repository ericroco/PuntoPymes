<div class="page-container">

    <div class="page-header">
        <div>
            <h1>Mis Reportes de Gastos</h1>
            <p class="subtitle">Gestiona tus viáticos y reembolsos.</p>
        </div>
        <button mat-flat-button color="primary" (click)="openCreateDialog()">
            <mat-icon>add</mat-icon> Nuevo Reporte
        </button>
    </div>

    <div class="table-container mat-elevation-z2">

        <div class="empty-state" *ngIf="!isLoading && reports.length === 0">
            <mat-icon>receipt_long</mat-icon>
            <h3>No tienes reportes</h3>
            <p>Crea uno nuevo para empezar a registrar tus gastos.</p>
        </div>

        <table mat-table [dataSource]="reports" *ngIf="reports.length > 0">

            <ng-container matColumnDef="titulo">
                <th mat-header-cell *matHeaderCellDef> Reporte </th>
                <td mat-cell *matCellDef="let element">
                    <div class="report-info">
                        <span class="title">{{ element.titulo }}</span>
                        <span class="desc">{{ element.descripcion }}</span>
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="fecha">
                <th mat-header-cell *matHeaderCellDef> Fecha Creación </th>
                <td mat-cell *matCellDef="let element"> {{ element.createdAt | date:'mediumDate' }} </td>
            </ng-container>

            <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef> Total </th>
                <td mat-cell *matCellDef="let element">
                    <strong>{{ element.total | currency }}</strong>
                </td>
            </ng-container>

            <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef> Estado </th>
                <td mat-cell *matCellDef="let element">
                    <span class="status-badge" [ngClass]="getStatusClass(element.estado)">
                        {{ element.estado }}
                    </span>
                </td>
            </ng-container>

            <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef> Acciones </th>
                <td mat-cell *matCellDef="let element">
                    <button mat-icon-button color="primary" (click)="goToDetail(element.id)"
                        [matTooltip]="element.estado === 'BORRADOR' ? 'Editar Items' : 'Ver Detalle'">
                        <mat-icon>{{ element.estado === 'BORRADOR' ? 'edit' : 'visibility' }}</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>
</div>