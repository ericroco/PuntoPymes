<div class="page-container policies-page">

    <header class="page-header">
        <div class="header-text">
            <h2>Políticas y Normativas</h2>
            <p class="subtitle">Documentación oficial y reglamentos de la empresa.</p>
        </div>

        <button *ngIf="canManagePolicies" mat-flat-button color="primary" (click)="openUploadDialog()">
            <mat-icon>add</mat-icon> Nueva Política
        </button>
    </header>

    <div class="table-wrapper mat-elevation-z2">

        <table mat-table [dataSource]="dataSource" *ngIf="dataSource.length > 0" class="custom-table">

            <ng-container matColumnDef="icon">
                <th mat-header-cell *matHeaderCellDef class="col-icon"> Tipo </th>
                <td mat-cell *matCellDef="let doc" class="col-icon">
                    <mat-icon class="doc-icon" [class.pdf]="isPdf(doc.nombre)">
                        {{ isPdf(doc.nombre) ? 'picture_as_pdf' : 'description' }}
                    </mat-icon>
                </td>
            </ng-container>

            <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef> Documento </th>
                <td mat-cell *matCellDef="let doc">
                    <span class="doc-name">{{ doc.nombre }}</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="categoria">
                <th mat-header-cell *matHeaderCellDef> Categoría </th>
                <td mat-cell *matCellDef="let doc">
                    <span class="category-chip">{{ doc.categoria }}</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="fecha">
                <th mat-header-cell *matHeaderCellDef> Publicado </th>
                <td mat-cell *matCellDef="let doc" class="text-muted">
                    {{ doc.fechaSubida | date:'mediumDate' }}
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let doc" class="text-right">
                    <div class="actions-group">
                        <button mat-icon-button class="action-btn view" (click)="download(doc.url)"
                            matTooltip="Leer Documento">
                            <mat-icon>visibility</mat-icon>
                        </button>

                        <button *ngIf="canManagePolicies" mat-icon-button class="action-btn delete"
                            (click)="deleteDoc(doc.id)" matTooltip="Eliminar">
                            <mat-icon>delete_outline</mat-icon>
                        </button>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-row"></tr>
        </table>

        <div *ngIf="dataSource.length === 0" class="empty-state">
            <div class="icon-wrapper">
                <mat-icon>policy</mat-icon>
            </div>
            <h3>Sin documentos</h3>
            <p>No hay políticas publicadas en este momento.</p>
            <button *ngIf="canManagePolicies" mat-stroked-button color="primary" (click)="openUploadDialog()">
                Subir el primero
            </button>
        </div>

    </div>
</div>