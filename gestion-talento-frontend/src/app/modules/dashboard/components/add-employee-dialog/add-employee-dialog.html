<h1 mat-dialog-title>Añadir Nuevo Empleado</h1>

<div mat-dialog-content class="stepper-container">
  <mat-vertical-stepper [linear]="true" #stepper>

    <mat-step [stepControl]="step1Form">
      <form [formGroup]="step1Form">
        <ng-template matStepLabel>Información Personal</ng-template>

        <mat-form-field appearance="outline">
          <mat-label>Nombre Completo</mat-label>
          <input matInput formControlName="name" required>
          <mat-error>El nombre es obligatorio.</mat-error>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Correo Electrónico</mat-label>
            <input matInput type="email" formControlName="email" required>
            <mat-error>Correo inválido u obligatorio.</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Teléfono / Celular</mat-label>
            <input matInput type="tel" formControlName="phone" required>
            <mat-error>El teléfono es obligatorio.</mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Fecha de Nacimiento (Opcional)</mat-label>
          <input matInput [matDatepicker]="dobPicker" formControlName="dateOfBirth">
          <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
          <mat-datepicker #dobPicker></mat-datepicker>
        </mat-form-field>

        <div class="step-actions">
          <button mat-flat-button color="primary" matStepperNext>Siguiente</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="step2Form">
      <form [formGroup]="step2Form">
        <ng-template matStepLabel>Información Laboral</ng-template>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Cargo / Rol</mat-label>
            <mat-select formControlName="job" required>
              <mat-option *ngFor="let job of availableJobs" [value]="job">{{ job.name }}</mat-option>
            </mat-select>
            <mat-error *ngIf="step2Form.get('job')?.hasError('required')">
              Debes seleccionar un cargo.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Departamento</mat-label>
            <input matInput [value]="step2Form.get('job')?.value?.department || ''" [disabled]="true"
              placeholder="Se asigna con el cargo">
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Reporta a (Jefe)</mat-label>
          <mat-select formControlName="reportsTo" required>
            <mat-option *ngFor="let manager of availableManagers" [value]="manager.name">{{ manager.name }}</mat-option>
          </mat-select>
          <mat-error *ngIf="step2Form.get('reportsTo')?.hasError('required')">
            Debes seleccionar un supervisor.
          </mat-error>
        </mat-form-field>
        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Tipo de Contrato</mat-label>
            <mat-select formControlName="contractType" required>
              <mat-option value="Indefinido">Indefinido</mat-option>
              <mat-option value="Plazo Fijo">Plazo Fijo</mat-option>
              <mat-option value="Servicios Profesionales">Servicios Prof.</mat-option>
              <mat-option value="Pasantía">Pasantía</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Fecha de Inicio</mat-label>
            <input matInput [matDatepicker]="pickerStart" formControlName="hireDate" required>
            <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
            <mat-datepicker #pickerStart></mat-datepicker>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Fecha de Finalización (Opcional)</mat-label>
          <input matInput [matDatepicker]="pickerEnd" formControlName="contractEndDate">
          <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
          <mat-datepicker #pickerEnd></mat-datepicker>
          <mat-hint>Dejar vacío si es indefinido</mat-hint>
        </mat-form-field>

        <div class="step-actions">
          <button mat-stroked-button matStepperPrevious>Atrás</button>
          <button mat-flat-button color="primary" matStepperNext>Siguiente</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="step3Form">
      <form [formGroup]="step3Form">
        <ng-template matStepLabel>Compensación Inicial</ng-template>
        <mat-form-field appearance="outline">
          <mat-label>Salario Inicial (USD)</mat-label>
          <input matInput type="number" formControlName="initialSalary" placeholder="Ej: 1500" required>
          <mat-icon matSuffix>$</mat-icon>
          <mat-hint *ngIf="selectedJobSalaryRange">{{ selectedJobSalaryRange }}</mat-hint>
          <mat-error *ngIf="step3Form.get('initialSalary')?.hasError('required')">Salario requerido.</mat-error>
          <mat-error *ngIf="step3Form.get('initialSalary')?.hasError('min')">El salario es muy bajo para este
            cargo.</mat-error>
          <mat-error *ngIf="step3Form.get('initialSalary')?.hasError('max')">El salario excede el máximo para este
            cargo.</mat-error>
        </mat-form-field>
        <div class="step-actions">
          <button mat-stroked-button matStepperPrevious>Atrás</button>
          <button mat-flat-button color="primary" matStepperNext>Siguiente</button>
        </div>
      </form>
    </mat-step>

    <mat-step>
      <ng-template matStepLabel>Revisar y Crear</ng-template>
      <div class="review-section">
        <h4>Revisa los datos antes de crear:</h4>

        <mat-divider></mat-divider>
        <p><strong>Nombre:</strong> {{ step1Form.value.name }}</p>
        <p><strong>Email:</strong> {{ step1Form.value.email }}</p>
        <p><strong>Cargo:</strong> {{ step2Form.value.role }}</p>
        <p><strong>Salario:</strong> {{ step3Form.value.initialSalary | currency:'USD' }}</p>

        <p class="review-note">Podrás editar otros detalles (horario, campos personalizados) desde el perfil del
          empleado después de crearlo.</p>
      </div>

      <div class="step-actions">
        <button mat-stroked-button matStepperPrevious>Atrás</button>
      </div>
    </mat-step>

  </mat-vertical-stepper>
</div>

<div mat-dialog-actions align="end" class="modal-actions">
  <button mat-stroked-button (click)="onCancel()">Cancelar Creación</button>
  <button mat-flat-button color="primary" (click)="onSave()"
    [disabled]="!step1Form.valid || !step2Form.valid || !step3Form.valid">
    Crear Empleado
  </button>
</div>