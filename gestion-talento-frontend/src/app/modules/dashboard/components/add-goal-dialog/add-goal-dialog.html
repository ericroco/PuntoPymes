<h2 mat-dialog-title>Crear Nuevo Objetivo</h2>

<form [formGroup]="form" (ngSubmit)="onSave()">
    <mat-dialog-content class="dialog-content">

        <div class="type-selection" *ngIf="data.isAdmin" style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: #666; font-weight: 500;">Tipo de Meta:</label>
            <mat-radio-group formControlName="tipo" color="primary" style="display: flex; gap: 20px;">
                <mat-radio-button value="PERSONAL">Personal</mat-radio-button>
                <mat-radio-button value="DEPARTAMENTO">Departamental</mat-radio-button>
            </mat-radio-group>
        </div>

        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descripci√≥n del Objetivo</mat-label>
            <textarea matInput formControlName="descripcion"
                placeholder="Ej: Incrementar la cobertura de pruebas al 80%" rows="3" required></textarea>
            <mat-error *ngIf="form.get('descripcion')?.hasError('required')">Requerido</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width"
            *ngIf="data.isAdmin && form.get('tipo')?.value === 'PERSONAL'">
            <mat-label>Asignar a Empleado</mat-label>
            <mat-select formControlName="empleadoId" required>
                <mat-option *ngFor="let emp of data.employees" [value]="emp.id">
                    {{ emp.nombre }} {{ emp.apellido }}
                </mat-option>
            </mat-select>
            <mat-error>Debes asignar un responsable</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width"
            *ngIf="data.isAdmin && form.get('tipo')?.value === 'DEPARTAMENTO'">
            <mat-label>Asignar a Departamento</mat-label>
            <mat-select formControlName="departamentoId" required>
                <mat-option *ngFor="let dept of data.departments" [value]="dept.id">
                    {{ dept.nombre }}
                </mat-option>
            </mat-select>
            <mat-error>Debes seleccionar un departamento</mat-error>
        </mat-form-field>

        <div class="progress-section">
            <label style="color: #666;">Progreso Inicial: <strong>{{ form.get('progreso')?.value }}%</strong></label>
            <mat-slider min="0" max="100" step="5" discrete showTickMarks>
                <input matSliderThumb formControlName="progreso">
            </mat-slider>
        </div>

    </mat-dialog-content>

    <mat-dialog-actions align="end">
        <button type="button" mat-button mat-dialog-close>Cancelar</button>
        <button type="submit" mat-flat-button color="primary" [disabled]="form.invalid">
            Crear Objetivo
        </button>
    </mat-dialog-actions>
</form>