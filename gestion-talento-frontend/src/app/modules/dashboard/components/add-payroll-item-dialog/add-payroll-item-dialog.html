<h1 mat-dialog-title>Registrar Novedad</h1>

<form [formGroup]="itemForm" (ngSubmit)="onSave()">
  <div mat-dialog-content class="payroll-form-content custom-scroll">

    <div class="dialog-subtitle-container" *ngIf="employeeName || selectedCount > 0">
      <div *ngIf="employeeName" class="info-pill">
        <mat-icon>person</mat-icon> {{ employeeName }}
      </div>
      <div *ngIf="selectedCount > 0" class="info-pill action">
        <mat-icon>layers</mat-icon> {{ selectedCount }} empleados
      </div>
    </div>

    <mat-form-field appearance="outline" class="full-width custom-field">
      <mat-label>Tipo de Novedad</mat-label>
      <mat-select formControlName="concepto" required placeholder="Selecciona concepto">

        <mat-select-trigger>
          <div class="trigger-content" *ngIf="itemForm.get('concepto')?.value as selected">
            <mat-icon [class.icon-ingreso]="selected.tipo === 'Ingreso'"
              [class.icon-egreso]="selected.tipo === 'Egreso'">
              {{ selected.tipo === 'Ingreso' ? 'arrow_upward' : 'arrow_downward' }}
            </mat-icon>
            <span>{{ selected.nombre }}</span>
          </div>
        </mat-select-trigger>

        <mat-icon matIconSuffix>category</mat-icon>

        <mat-option *ngIf="availableItems.length === 0" disabled>
          No hay conceptos configurados.
        </mat-option>

        <mat-optgroup label="Ingresos">
          <mat-option *ngFor="let item of availableItems | filterByType:'Ingreso'" [value]="item">
            <mat-icon class="icon-ingreso">arrow_upward</mat-icon> {{ item.nombre }}
          </mat-option>
        </mat-optgroup>

        <mat-optgroup label="Egresos">
          <mat-option *ngFor="let item of availableItems | filterByType:'Egreso'" [value]="item">
            <mat-icon class="icon-egreso">arrow_downward</mat-icon> {{ item.nombre }}
          </mat-option>
        </mat-optgroup>

      </mat-select>
      <mat-error>Requerido.</mat-error>
    </mat-form-field>

    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field custom-field">
        <mat-label>Monto</mat-label>
        <input matInput type="number" formControlName="amount" placeholder="0.00" min="0" required>
        <span matTextPrefix>$&nbsp;</span>
        <mat-icon matIconSuffix>attach_money</mat-icon>
        <mat-error>Requerido.</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field custom-field">
        <mat-label>Fecha</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="applicationDate" required readonly
          (click)="picker.open()">
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error>Requerido.</mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="full-width custom-field">
      <mat-label>Observaciones</mat-label>
      <textarea matInput formControlName="comments" rows="3" placeholder="Detalles opcionales..."></textarea>
      <mat-icon matIconSuffix>edit_note</mat-icon>
    </mat-form-field>

  </div>

  <div mat-dialog-actions align="end">
    <button type="button" mat-stroked-button (click)="onCancel()">Cancelar</button>
    <button type="submit" mat-flat-button color="primary" [disabled]="itemForm.invalid">
      Guardar
    </button>
  </div>
</form>