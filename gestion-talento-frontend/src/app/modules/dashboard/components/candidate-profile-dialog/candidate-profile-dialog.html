<div class="profile-header-dialog">
    <div class="info-principal">
        <div class="avatar-placeholder-large">
            {{ getInitials(candidate.nombre) }}
        </div>

        <div class="text-info">
            <h1 mat-dialog-title>{{ candidate.nombre }}</h1>
            <p class="subtitle">{{ candidate.email }}</p>
        </div>
    </div>

    <div class="ai-badge-dialog" [ngClass]="getScoreColor(candidate.aiScore)"
        [matTooltip]="'IA: ' + (candidate.aiScore || 0) + '% de coincidencia'">
        <mat-icon>auto_awesome</mat-icon>
        <span>{{ candidate.aiScore || 0 }}% Match</span>
    </div>
</div>

<mat-divider></mat-divider>

<div mat-dialog-content class="profile-content">
    <mat-tab-group animationDuration="0ms">

        <mat-tab label="Perfil y CV">
            <div class="tab-content-container">

                <div class="ai-analysis-box" *ngIf="candidate.aiAnalysis">
                    <h4>ü§ñ An√°lisis de Inteligencia Artificial</h4>
                    <p>{{ candidate.aiAnalysis }}</p>
                </div>

                <div class="cv-viewer-container">
                    <h4>Curr√≠culum Vitae</h4>
                    <div class="cv-placeholder">
                        <mat-icon class="pdf-icon">picture_as_pdf</mat-icon>
                        <span>Documento Original</span>

                        <a [href]="candidate.cvUrl" target="_blank" mat-stroked-button color="primary"
                            [disabled]="!candidate.cvUrl">
                            <mat-icon>open_in_new</mat-icon> Abrir CV en nueva pesta√±a
                        </a>
                    </div>
                </div>

                <div class="details-container">
                    <h4>Informaci√≥n de Contacto</h4>
                    <mat-list>
                        <mat-list-item>
                            <mat-icon matListItemIcon>email</mat-icon>
                            <div matListItemTitle>Correo</div>
                            <div matListItemLine>{{ candidate.email }}</div>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-icon matListItemIcon>phone</mat-icon>
                            <div matListItemTitle>Tel√©fono</div>
                            <div matListItemLine>{{ candidate.telefono }}</div>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-icon matListItemIcon>calendar_today</mat-icon>
                            <div matListItemTitle>Fecha Postulaci√≥n</div>
                            <div matListItemLine>{{ candidate.fechaPostulacion | date:'mediumDate' }}</div>
                        </mat-list-item>
                    </mat-list>
                </div>
            </div>
        </mat-tab>

        <mat-tab label="Historial y Notas">
            <div class="tab-content-container">
                <div class="notes-section">
                    <h4>A√±adir Nueva Nota (Local)</h4>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Escribe un comentario...</mat-label>
                        <textarea matInput [(ngModel)]="newNote" rows="3"></textarea>
                    </mat-form-field>
                    <button mat-stroked-button color="primary" (click)="addNote()" [disabled]="!newNote.trim()">
                        <mat-icon>add_comment</mat-icon> Guardar Nota
                    </button>
                </div>

                <div class="activity-feed-section">
                    <h4>Historial de Actividad</h4>
                    <mat-list class="activity-feed">
                        <div *ngFor="let item of activityHistory" class="feed-item">
                            <div class="feed-icon"><mat-icon>history</mat-icon></div>
                            <div class="feed-content">
                                <div class="feed-action">{{ item.action }}</div>
                                <div class="feed-date">{{ item.date | date:'medium' }}</div>
                            </div>
                        </div>
                    </mat-list>
                </div>
            </div>
        </mat-tab>

    </mat-tab-group>
</div>

<mat-divider></mat-divider>

<div mat-dialog-actions align="end">
    <button mat-stroked-button (click)="onClose()">Cerrar</button>
    <button mat-flat-button color="primary" (click)="moveToNextPhase()">
        <mat-icon>keyboard_arrow_right</mat-icon>
        Mover a Siguiente Fase
    </button>
</div>