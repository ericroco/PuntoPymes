<div class="profile-header-dialog">
    <div class="info-principal">
        <img [src]="candidate.avatar" [alt]="candidate.name" class="avatar-large">
        <div class="text-info">
            <h1 mat-dialog-title>{{ candidate.name }}</h1>
            <p class="subtitle">{{ candidate.currentRole }}</p>
        </div>
    </div>
    <div class="ai-badge-dialog" [ngClass]="{
         'high': candidate.aiMatch >= 90,
         'medium': candidate.aiMatch >= 75 && candidate.aiMatch < 90,
         'low': candidate.aiMatch < 75
       }" [matTooltip]="'IA: ' + candidate.aiReason">
        <mat-icon>auto_awesome</mat-icon>
        <span>{{ candidate.aiMatch }}% Match</span>
    </div>
</div>

<mat-divider></mat-divider>

<div mat-dialog-content class="profile-content">
    <mat-tab-group animationDuration="0ms">

        <mat-tab label="Perfil y CV">
            <div class="tab-content-container">
                <div class="cv-viewer-container">
                    <h4>Currículum Vitae</h4>
                    <div class="cv-placeholder">
                        <mat-icon>picture_as_pdf</mat-icon>
                        <span>{{ candidate.name }}_CV.pdf</span>
                        <a [href]="candidateDetails.cvUrl" target="_blank" mat-stroked-button color="primary">
                            Abrir CV en nueva pestaña
                        </a>
                    </div>
                </div>
                <div class="details-container">
                    <h4>Información de Contacto</h4>
                    <mat-list>
                        <mat-list-item>
                            <mat-icon matListItemIcon>email</mat-icon>
                            <div matListItemTitle>{{ candidateDetails.email }}</div>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-icon matListItemIcon>phone</mat-icon>
                            <div matListItemTitle>{{ candidateDetails.phone }}</div>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-icon matListItemIcon>link</mat-icon>
                            <a matListItemTitle [href]="'https://' + candidateDetails.linkedin" target="_blank">{{
                                candidateDetails.linkedin }}</a>
                        </mat-list-item>
                    </mat-list>

                    <h4 class="skills-title">Habilidades Clave</h4>
                    <div class="skills-list">
                        <span *ngFor="let skill of candidateDetails.skills" class="skill-badge">{{ skill }}</span>
                    </div>
                </div>
            </div>
        </mat-tab>

        <mat-tab label="Historial y Notas">
            <div class="tab-content-container">
                <div class="notes-section">
                    <h4>Añadir Nueva Nota</h4>
                    <mat-form-field appearance="outline">
                        <mat-label>Escribe un comentario (ej. "Buena entrevista")...</mat-label>
                        <textarea matInput [(ngModel)]="newNote" rows="3"></textarea>
                    </mat-form-field>
                    <button mat-stroked-button color="primary" (click)="addNote()" [disabled]="!newNote.trim()">
                        <mat-icon>add_comment</mat-icon> Guardar Nota
                    </button>
                </div>
                <div class="activity-feed-section">
                    <h4>Historial de Actividad</h4>
                    <mat-list class="activity-feed">
                        <mat-list-item *ngFor="let item of activityHistory">
                            <mat-icon matListItemIcon>history</mat-icon>
                            <div matListItemTitle>{{ item.action }}</div>
                            <div matListItemLine>{{ item.date | date:'dd MMM, yyyy' }}</div>
                        </mat-list-item>
                    </mat-list>
                </div>
            </div>
        </mat-tab>

    </mat-tab-group>
</div>

<mat-divider></mat-divider>

<div mat-dialog-actions align="end">
    <button mat-stroked-button (click)="onClose()">Cerrar</button>
    <button mat-flat-button color="primary" (click)="moveToNextPhase()">
        <mat-icon>keyboard_arrow_right</mat-icon>
        Mover a Siguiente Fase
    </button>
</div>